---
title: 组件和状态的设计思路
categories:
  - Code
tags:
  - 编程方法论
abbrlink: 33633
date: 2021-08-01 15:26:11
updated: 2021-09-19 21:33:47
---

在参与腾讯健康小程序的开发过程中，我遇到了一个常见的问题：由于页面功能过于复杂，导致页面的代码异常复杂，而且年代久远，重构起来成本过高。这个问题也是很多项目都会面临的。

由于 React、Vue 等框架都是以数据驱动视图，所以我拿到一个模块需求，我会从“状态”和“视图”两方面入手分析需求。基于此，我总结出了以下几点设计要点：

## 状态数据结构设计

<!-- - 用数据描述所有的内容
- 数据要结构化，易于程序操作（遍历、查找）
- 数据要可扩展，以便增加新的功能 -->

用数据描述所有的内容。除了一些简单的静态页面外，所有的页面都需要依赖数据来渲染视图。因此，在设计页面结构时，首先要考虑的就是如何设计好状态数据结构。数据要结构化，易于程序操作（遍历、查找），同时也要可扩展，以便增加新的功能。

例如，在健康小程序中，我们可以定义一个 User 对象来存储用户信息，包含用户名、性别、年龄等属性。然后，对于每个功能模块，我们可以定义单独的对象来存储相关的数据。这样做不仅有利于代码的组织和维护，同时也有助于提高程序的可读性和可扩展性。

## 组件设计（拆分、组合）和组件通讯

<!-- - 从功能上拆分层次
- 尽量让组件原子化（一个组件只做一个功能，吸收复杂度）
- 容器组件（只管理数据）&UI 组件（只显示视图） -->

从功能上拆分层次。在设计组件时，首先要考虑的就是如何将页面拆分成更小的组件，并且尽量让组件原子化（一个组件只做一个功能）。这样可以有效地降低组件之间的耦合度，吸收复杂度。

例如，在健康小程序中，我们可以定义一个 User 组件用于渲染用户信息。对于每个功能模块，我们可以定义一个独立的业务组件，比如“体检报告”组件、"健康资讯”组件等。这些业务组件都可以通过 props 属性来接收和传递数据。此外，为了提高组件的复用性，我们还可以定义一些通用的 UI 组件，比如表格、弹框等。

容器组件（只管理数据）&UI 组件（只显示视图）。在设计组件时，我们还需要考虑组件之间的通信方式。容器组件（Container Component）负责管理数据，它们从 store 中获取数据并将其传递给 UI 组件。而 UI 组件（Presentational Component）则负责显示视图，它们只接受 props 属性，并将其渲染为对应的 HTML。这种分层的方式可以有效地降低组件之间的耦合度，提高代码的可维护性和可读性。

最后，需要注意的是，在实际开发中，以上设计思路也需要根据实际情况进行调整和优化。但总的来说，通过从“状态”和“视图”两方面入手，我们可以更好地组织和管理页面的代码结构，提高程序的可扩展性和可维护性。
