---
title: 医典前端监控
categories:
  - Code
tags:
  - 小程序
  - 工作总结
abbrlink: 46416
date: 2020-07-07 22:02:10
updated: 2021-10-02 22:09:06
---

医典的前端监控分为以下几类：

- 错误、异常监控类：包括 js 错误、后端接口错误、ajax 请求错误、资源加载错误等

- 用户日志类：包括实时日志（白名单日志）、离线日志；

- 测速类：页面测速（首屏和页面切换）、cdn 资源加载测速、cgi 测速

- 用户信息类：包括用户的 ua、机型、网段、地区、ip 等（主要是出现在日志信息内，帮助分析问题）

- 告警：包括各分类的错误量的告警和波动告警

结合医典的场景以及前端的框架，决定使用以下的监控体系：

使用一站式的监控平台 aegis（原因：支持离线日志和白名单日志；且也涵盖大部分的监控类（js、资源、请求监控），也支持 cgi 等测速；且维护人员稳定，Oteam 协同）

### 错误、异常监控类：

h5：考虑直接使用 aegis，对聚类可能不是很友好，但是错误信息收集已经比较完善；

小程序：直接使用 aegis + 微信小程序管理后台的错误日志管理

### 用户日志类：

日志我们将完全使用 aegis，但是需要进行方案优化（因为医典是使用异步登录）；方案在后面详细说明

### 测速类：

1. 页面测速：完善医典自身的测速（测速维度更加精准，且支持小程序，后续可关联接口耗时）

2. cgi 测速：h5 使用医典的 cgi 测速（医典 cgi 测速包含 performance，更精确）；小程序目前还没有测速，先接入 aegis 的测速，后续迁移到医典测速；

3. cdn 资源测速：使用 aegis 测速；

### 用户信息类：

选用 aegis，各个平台用户基础信息功能差异不大；

### 告警：

可以尝试使用 aegis 自有告警。支持超每分钟 n 次（阀值）告警 和 错误率（错误数/p v）告警；支持大分类告警；
